<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte Interactivo de Estrategias USD/CLP v3.2 FINAL</title>
    <style>
        :root {
            --azul-principal: #005FFF;
            --verde-ganancia: #59A80F;
            --rojo-perdida: #F40034;
            --amarillo-atencion: #F9B316;
            --fondo-verde: #EBF3E7;
            --fondo-rojo: #FEEBEE;
            --fondo-amarillo: #FDF7E8;
            --fondo-azul: #E1E9FD;
            --gris-texto: #333;
            --gris-claro: #f4f4f9;
            --borde-color: #ddd;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--gris-claro);
            color: var(--gris-texto);
        }

        .container {
            max-width: 1200px;
            margin: auto;
            background: #fff;
            padding: 20px 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        header {
            text-align: center;
            border-bottom: 2px solid var(--borde-color);
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        header h1 { color: var(--azul-principal); margin: 0; font-size: 2.2em; }
        header p { margin: 5px 0 0; font-size: 1.1em; color: #666; }

        h2 { color: var(--azul-principal); border-bottom: 2px solid var(--azul-principal); padding-bottom: 10px; margin-top: 40px; }
        h3 { color: var(--gris-texto); }

        .market-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card { background: #fff; padding: 20px; border: 1px solid var(--borde-color); border-left: 5px solid var(--azul-principal); border-radius: 5px; }
        .card h3 { margin-top: 0; }
        .card-vol { border-color: var(--amarillo-atencion); }
        .card-skew { border-color: var(--azul-principal); }
        .card-kurt { border-color: var(--verde-ganancia); }

        .card .value { font-size: 1.8em; font-weight: bold; margin-bottom: 10px; }
        .card-vol .value { color: var(--amarillo-atencion); }
        .card-skew .value { color: var(--azul-principal); }
        .card-kurt .value { color: var(--verde-ganancia); }
        
        .vol-chart-container, .anexo-section { margin-top: 30px; padding: 20px; border: 1px solid var(--borde-color); border-radius: 8px; }
        .anexo-section { background-color: var(--fondo-azul); }

        .tenor-selector { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .tenor-selector button {
            padding: 8px 15px; border: 1px solid var(--borde-color); border-radius: 20px; background-color: #fff; cursor: pointer;
            font-size: 0.9em; transition: background-color 0.2s, color 0.2s;
        }
        .tenor-selector button.active { background-color: var(--azul-principal); color: #fff; border-color: var(--azul-principal); font-weight: bold; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid var(--borde-color); padding: 12px; text-align: left; }
        th { background-color: var(--fondo-azul); font-weight: bold; }
        tr:nth-child(even) { background-color: var(--gris-claro); }
        
        .strategy-details { margin-top: 40px; padding: 20px; border-radius: 8px; border: 1px solid var(--borde-color); }
        .recommended { background-color: var(--fondo-verde); border-left: 5px solid var(--verde-ganancia); }
        .alternative { background-color: var(--fondo-amarillo); border-left: 5px solid var(--amarillo-atencion); }

        .interactive-section { display: flex; align-items: center; justify-content: space-between; gap: 30px; margin-top: 20px; flex-wrap: wrap; }
        .pnl-chart-container { flex: 2; min-width: 400px; }
        .controls { flex: 1; min-width: 280px; background: #fff; padding: 20px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .slider { width: 100%; cursor: pointer; }
        .pnl-display { font-size: 1.5em; font-weight: bold; text-align: center; padding: 10px; border-radius: 5px; margin-top: 15px; transition: background-color 0.3s, color 0.3s; }
        .pnl-display .label { display: block; font-size: 0.6em; font-weight: normal; color: #666; text-transform: uppercase; }
        .pnl-profit { background-color: var(--fondo-verde); color: var(--verde-ganancia); }
        .pnl-loss { background-color: var(--fondo-rojo); color: var(--rojo-perdida); }

        .discarded-table td:first-child { font-weight: bold; }
        .disclaimer { margin-top: 40px; font-size: 0.8em; color: #999; text-align: justify; }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Reporte Interactivo de Estrategias USD/CLP</h1>
            <p>Fecha de Análisis: 29 de Septiembre, 2025</p>
        </header>

        <main>
            <section>
                <h2>Análisis de Mercado</h2>
                <div class="market-analysis">
                    <div class="card card-vol"><h3>Volatilidad Implícita (1 Mes)</h3><div class="value">11,30%</div><p>La volatilidad implícita supera a la histórica. Esto indica que las primas de las opciones están <strong>relativamente caras</strong>, favoreciendo la venta de volatilidad.</p></div>
                    <div class="card card-skew"><h3>Skew (Risk Reversal 25D, 1 Mes)</h3><div class="value">+1,431%</div><p>Un valor fuertemente positivo revela una mayor demanda por Calls. El mercado tiene un claro <strong>sesgo alcista</strong> para el USD/CLP.</p></div>
                    <div class="card card-kurt"><h3>Kurtosis (Butterfly 25D, 1 Mes)</h3><div class="value">0,234%</div><p>Un valor bajo sugiere que el mercado no asigna una probabilidad elevada a movimientos extremos. Esto hace más eficientes las <strong>estrategias de riesgo definido</strong>.</p></div>
                </div>
                <div class="vol-chart-container">
                     <h3>Gráfico Interactivo de Volatility Skew</h3>
                     <p>Selecciona un plazo para visualizar su "sonrisa de volatilidad". La pendiente ascendente (de Puts a Calls) confirma el sesgo alcista del mercado, que se intensifica en los plazos más largos.</p>
                     <div class="tenor-selector" id="tenorSelector">
                        <button data-tenor="1M" class="active">1 Mes</button>
                        <button data-tenor="3M">3 Meses</button>
                        <button data-tenor="6M">6 Meses</button>
                        <button data-tenor="1Y">1 Año</button>
                     </div>
                     <svg id="volSkewChart" viewbox="0 0 500 300"></svg>
                </div>
            </section>

            <section class="anexo-section">
                <h2>Anexo: ¿Qué es el Delta de una Opción?</h2>
                <h3>¿Qué es el Delta (&Delta;) de una Opción?</h3>
                <p>Piensa en el <strong>Delta</strong> como el <strong>velocímetro</strong> de una opción. Mide qué tan rápido y en qué dirección cambia el precio (la prima) de la opción por cada peso que se mueve el tipo de cambio (el spot).</p>
                <p>En términos simples, el Delta te dice <strong>cuántos pesos se espera que gane o pierda tu opción si el dólar sube CLP 1</strong>.</p>
                <h3>¿Cómo Leer el Delta?</h3>
                <h4>1. Rango de Valores</h4><ul><li><strong>Opciones Call (de Compra):</strong> El Delta es <strong>positivo</strong>, entre 0 y 100.</li><li><strong>Opciones Put (de Venta):</strong> El Delta es <strong>negativo</strong>, entre -100 y 0.</li></ul>
                <h4>2. Interpretación Directa (El Velocímetro)</h4><ul><li>Un <strong>Call con Delta 60</strong> significa que si el spot sube de 959 a 960, la prima del call aumentará en <strong>CLP 0,60</strong>.</li><li>Un <strong>Put con Delta -40</strong> significa que si el spot sube de 959 a 960, la prima del put <strong>perderá</strong> <strong>CLP 0,40</strong>.</li></ul>
                <h4>3. Delta como Probabilidad (El Pronóstico)</h4>
                <p>El valor absoluto del Delta es una excelente <strong>aproximación de la probabilidad</strong> de que la opción termine *"in-the-money"* al vencimiento.</p>
                <ul><li><strong>25D Call:</strong> Un "25D Call" tiene un <strong>Delta de 25</strong>, lo que implica un <strong>25% de probabilidad</strong> de que el dólar termine sobre su strike.</li><li><strong>25D Put:</strong> Un "25D Put" tiene un <strong>Delta de -25</strong>, implicando un <strong>25% de probabilidad</strong> de que el dólar termine bajo su strike.</li></ul>
            </section>

            <section>
                <h2>Tabla Comparativa de Estrategias</h2>
                <table>
                    <thead><tr><th>Característica</th><th>Estrategia Recomendada (Bull Put Spread)</th><th>Estrategia Alternativa (Bull Call Spread)</th></tr></thead>
                    <tbody>
                        <tr><td><strong>Visión</strong></td><td>Alcista moderado</td><td>Alcista</td></tr>
                        <tr><td><strong>Plazo Recomendado</strong></td><td>30 Días (1 Mes)</td><td>30 Días (1 Mes)</td></tr>
                        <tr><td><strong>Estructura</strong></td><td>Venta Put K (955) / Compra Put K (940)</td><td>Compra Call K (965) / Venta Call K (980)</td></tr>
                        <tr><td><strong>Prima Neta (Nocional 1MM USD)</strong></td><td style="color: var(--verde-ganancia); font-weight: bold;">+ CLP 3.779.000</td><td style="color: var(--rojo-perdida); font-weight: bold;">- CLP 5.412.000</td></tr>
                        <tr><td><strong>Ganancia Máxima (Nocional 1MM USD)</strong></td><td style="color: var(--verde-ganancia);">+ CLP 3.779.000</td><td style="color: var(--verde-ganancia);">+ CLP 9.588.000</td></tr>
                        <tr><td><strong>Pérdida Máxima (Nocional 1MM USD)</strong></td><td style="color: var(--rojo-perdida);">- CLP 11.221.000</td><td style="color: var(--rojo-perdida);">- CLP 5.412.000</td></tr>
                        <tr><td><strong>Punto de Equilibrio (Break-Even)</strong></td><td style="font-weight: bold;">951,221</td><td style="font-weight: bold;">970,412</td></tr>
                        <tr><td><strong>Probabilidad de Éxito (Implícita)</strong></td><td>62%</td><td>36%</td></tr>
                    </tbody>
                </table>
            </section>

            <section id="strategy-recommended" class="strategy-details recommended">
                <h2>Estrategia Recomendada (Perfil Moderado): Bull Put Spread</h2>
                <p><strong>Justificación:</strong> Es la estrategia óptima para el escenario actual. Capitaliza la volatilidad cara al ingresar una prima, se alinea con la visión alcista del mercado y, lo más importante, tiene un riesgo definido y una alta probabilidad de éxito. La operación genera ganancias mientras el spot al vencimiento se mantenga por encima de 951,221.</p>
                <div class="interactive-section">
                    <div class="pnl-chart-container"><svg id="pnlChartBPS" viewbox="0 0 500 300"></svg></div>
                    <div class="controls">
                        <label for="spotSliderBPS">Simulador de Spot al Vencimiento:</label>
                        <input type="range" id="spotSliderBPS" class="slider" min="860" max="1060" step="0.1" value="959.26">
                        <div id="pnlDisplayBPS" class="pnl-display">
                            <span id="simSpotBPS">Spot: 959,26</span><br>
                            <span class="label">P&L (Contrato 1MM USD)</span>
                            <span id="pnlValueBPS">CLP 3.779.000</span>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="strategy-alternative" class="strategy-details alternative">
                <h2>Estrategia Alternativa: Bull Call Spread</h2>
                <p><strong>Justificación:</strong> Una alternativa para una visión alcista más direccional. En lugar de recibir una prima, se paga un costo acotado (débito) para obtener un mayor potencial de ganancia si el USD/CLP sube significativamente. La pérdida está limitada a la prima pagada. Es adecuada si se espera un alza por sobre el nivel de 970,412.</p>
                <div class="interactive-section">
                    <div class="pnl-chart-container"><svg id="pnlChartBCS" viewbox="0 0 500 300"></svg></div>
                    <div class="controls">
                        <label for="spotSliderBCS">Simulador de Spot al Vencimiento:</label>
                        <input type="range" id="spotSliderBCS" class="slider" min="860" max="1060" step="0.1" value="959.26">
                        <div id="pnlDisplayBCS" class="pnl-display">
                            <span id="simSpotBCS">Spot: 959,26</span><br>
                            <span class="label">P&L (Contrato 1MM USD)</span>
                            <span id="pnlValueBCS">-5.412.000</span>
                        </div>
                    </div>
                </div>
            </section>

            <section>
                <h2>Otras Estrategias Consideradas y Descartadas</h2>
                <p>Se analizaron otras estructuras comunes que fueron descartadas por las siguientes razones:</p>
                <table class="discarded-table">
                    <tr><td><strong>Compra de Straddle / Strangle</strong></td><td>Involucra comprar volatilidad. Dado que la volatilidad implícita ya está cara en comparación con la histórica, esta estrategia tiene un alto costo y un "carry" negativo por el paso del tiempo.</td></tr>
                    <tr><td><strong>Venta de Straddle / Strangle</strong></td><td>Aunque se beneficia de la volatilidad cara, esta estrategia conlleva un <strong>riesgo ilimitado</strong>, lo cual es inadecuado para un perfil de riesgo moderado.</td></tr>
                    <tr><td><strong>Compra de Call / Put (Seco)</strong></td><td>El alto nivel de volatilidad encarece la prima de las opciones individuales. Esto resulta en un punto de equilibrio muy exigente y una alta pérdida por el decaimiento del valor tiempo (theta).</td></tr>
                </table>
            </section>

            <section><p class="disclaimer"><strong>Disclaimer:</strong> Este reporte ha sido generado con fines informativos y educativos, basado en los datos de mercado proporcionados. No constituye una oferta o recomendación de inversión. Las estrategias con opciones financieras conllevan riesgos significativos, incluyendo la posible pérdida total de la inversión. Los cálculos de probabilidad son teóricos y no garantizan resultados futuros. Se recomienda consultar con un asesor financiero antes de realizar cualquier operación.</p></section>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    
    const contractSize = 1000000;
    const formatSpot = (num) => new Intl.NumberFormat('es-CL', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(num);
    const formatCLP = (num) => new Intl.NumberFormat('es-CL', { style: 'currency', currency: 'CLP', maximumFractionDigits: 0 }).format(num);
    
    const bps = { id: 'BPS', strikeShort: 955, strikeLong: 940, netPremium: 3.779, get breakEven() { return this.strikeShort - this.netPremium; }, get maxProfit() { return this.netPremium; }, get maxLoss() { return -(this.strikeShort - this.strikeLong) + this.netPremium; } };
    const bcs = { id: 'BCS', strikeLong: 965, strikeShort: 980, netDebit: 5.412, get breakEven() { return this.strikeLong + this.netDebit; }, get maxProfit() { return (this.strikeShort - this.strikeLong) - this.netDebit; }, get maxLoss() { return -this.netDebit; } };
    const spotRangeGlobal = [860, 1060];

    const calculateBpsPnl = (spot) => (spot >= bps.strikeShort) ? bps.maxProfit : (spot <= bps.strikeLong) ? bps.maxLoss : spot - bps.breakEven;
    const calculateBcsPnl = (spot) => (spot <= bcs.strikeLong) ? bcs.maxLoss : (spot >= bcs.strikeShort) ? bcs.maxProfit : spot - bcs.breakEven;

    // --- LÓGICA GRÁFICO SKEW INTERACTIVO ---
    const volData = {
        '1M': [{ delta: '15D Put', vol: 10.899 },{ delta: '25D Put', vol: 10.923 },{ delta: 'ATM', vol: 11.300 },{ delta: '25D Call', vol: 12.304 },{ delta: '15D Call', vol: 13.085 }],
        '3M': [{ delta: '15D Put', vol: 12.340 },{ delta: '25D Put', vol: 12.422 },{ delta: 'ATM', vol: 12.660 },{ delta: '25D Call', vol: 13.647 },{ delta: '15D Call', vol: 14.428 }],
        '6M': [{ delta: '15D Put', vol: 12.287 },{ delta: '25D Put', vol: 12.172 },{ delta: 'ATM', vol: 12.630 },{ delta: '25D Call', vol: 13.654 },{ delta: '15D Call', vol: 14.461 }],
        '1Y': [{ delta: '15D Put', vol: 12.307 },{ delta: '25D Put', vol: 12.370 },{ delta: 'ATM', vol: 12.850 },{ delta: '25D Call', vol: 13.940 },{ delta: '15D Call', vol: 14.945 }]
    };

    function updateSkewChart(tenor) {
        const data = volData[tenor];
        const svg = document.getElementById('volSkewChart');
        const width = 500, height = 300;
        const margin = { top: 20, right: 30, bottom: 40, left: 50 };
        const chartWidth = width - margin.left - margin.right;
        const chartHeight = height - margin.top - margin.bottom;

        const allVols = Object.values(volData).flat().map(d => d.vol);
        const minVol = Math.floor(Math.min(...allVols)) - 1;
        const maxVol = Math.ceil(Math.max(...allVols));

        const xScale = (delta) => {
            const index = data.findIndex(d => d.delta === delta);
            return margin.left + (index / (data.length - 1)) * chartWidth;
        };
        const yScale = (vol) => margin.top + chartHeight - ((vol - minVol) / (maxVol - minVol)) * chartHeight;

        svg.innerHTML = '';
        svg.innerHTML += `<line x1="${margin.left}" y1="${height - margin.bottom}" x2="${width - margin.right}" y2="${height - margin.bottom}" stroke="#ccc" />`;
        svg.innerHTML += `<line x1="${margin.left}" y1="${margin.top}" x2="${margin.left}" y2="${height - margin.bottom}" stroke="#ccc" />`;
        
        for (let i = minVol; i <= maxVol; i++) {
            if(i % 1 === 0) {
                svg.innerHTML += `<line x1="${margin.left}" y1="${yScale(i)}" x2="${width - margin.right}" y2="${yScale(i)}" stroke="#eee" />`;
                svg.innerHTML += `<text x="${margin.left - 10}" y="${yScale(i) + 4}" font-size="10" text-anchor="end">${i}%</text>`;
            }
        }

        data.forEach(d => { svg.innerHTML += `<text x="${xScale(d.delta)}" y="${height - margin.bottom + 15}" font-size="10" text-anchor="middle">${d.delta.replace(' Put','P').replace(' Call','C')}</text>`; });
        svg.innerHTML += `<text x="${width/2}" y="${height - 5}" font-size="12" text-anchor="middle">Delta de la Opción</text>`;
        
        let points = data.map(d => `${xScale(d.delta)},${yScale(d.vol)}`).join(' ');
        svg.innerHTML += `<polyline points="${points}" fill="none" stroke="var(--azul-principal)" stroke-width="3"/>`;
        data.forEach(d => { svg.innerHTML += `<circle cx="${xScale(d.delta)}" cy="${yScale(d.vol)}" r="4" fill="var(--azul-principal)" stroke="#fff" stroke-width="2"/>`; });
    }
    
    document.querySelectorAll('#tenorSelector button').forEach(button => {
        button.addEventListener('click', () => {
            document.querySelector('#tenorSelector button.active').classList.remove('active');
            button.classList.add('active');
            updateSkewChart(button.dataset.tenor);
        });
    });
    
    // --- LÓGICA GRÁFICOS P&L ---
    function drawPnlChart(config) {
        const { svgId, strategy } = config;
        const { pnlFunction, pnlRange, breakEven, strikeLong, strikeShort } = strategy;
        
        const svg = document.getElementById(svgId);
        const width = 500, height = 300, margin = { top: 20, right: 20, bottom: 50, left: 50 };
        const chartWidth = width - margin.left - margin.right, chartHeight = height - margin.top - margin.bottom;
        const xScale = (spot) => margin.left + ((spot - spotRangeGlobal[0]) / (spotRangeGlobal[1] - spotRangeGlobal[0])) * chartWidth;
        const yScale = (pnl) => margin.top + chartHeight - ((pnl - pnlRange[0]) / (pnlRange[1] - pnlRange[0])) * chartHeight;
        
        svg.innerHTML = '';
        
        // Ejes y Ticks del Eje X
        svg.innerHTML += `<line x1="${margin.left}" y1="${yScale(0)}" x2="${width - margin.right}" y2="${yScale(0)}" stroke="#888" stroke-width="1.5"/>`;
        for (let spotTick = Math.ceil(spotRangeGlobal[0]/10)*10; spotTick <= spotRangeGlobal[1]; spotTick += 10) {
            const x = xScale(spotTick);
            svg.innerHTML += `<line x1="${x}" y1="${yScale(0)}" x2="${x}" y2="${yScale(0)+4}" stroke="#aaa"/>`;
            svg.innerHTML += `<text x="${x}" y="${yScale(0)+14}" font-size="9" text-anchor="middle" fill="#666">${spotTick}</text>`;
        }
        
        // Líneas de Strikes y Break-Even
        const keyPoints = [
            { value: breakEven, color: 'var(--amarillo-atencion)', label: `BE ${formatSpot(breakEven)}` },
            { value: strikeLong, color: '#aaa', label: `K ${formatSpot(strikeLong)}` },
            { value: strikeShort, color: '#aaa', label: `K ${formatSpot(strikeShort)}` }
        ];

        keyPoints.forEach(p => {
            const x = xScale(p.value);
            svg.innerHTML += `<line x1="${x}" y1="${margin.top}" x2="${x}" y2="${height - margin.bottom}" stroke="${p.color}" stroke-width="1" stroke-dasharray="3,3"/>`;
            svg.innerHTML += `<text x="${x}" y="${height - margin.bottom + 25}" font-size="10" font-weight="bold" fill="${p.color}" text-anchor="middle">${p.label}</text>`;
        });
        
        svg.innerHTML += `<text x="${width/2}" y="${height - 5}" font-size="12" text-anchor="middle">Spot al Vencimiento</text>`;
        svg.innerHTML += `<text x="${margin.left - 10}" y="${margin.top + 10}" font-size="12" text-anchor="end">P&L</text>`;

        let points = '';
        const step = (spotRangeGlobal[1] - spotRangeGlobal[0]) / 200;
        for (let spot = spotRangeGlobal[0]; spot <= spotRangeGlobal[1]; spot += step) { points += `${xScale(spot)},${yScale(pnlFunction(spot))} `; }
        
        const breakEvenX = xScale(breakEven);
        svg.innerHTML += `<path d="${points} L ${xScale(spotRangeGlobal[1])},${yScale(0)} L ${breakEvenX},${yScale(0)} Z" fill="var(--fondo-verde)" />`;
        svg.innerHTML += `<path d="${points} L ${breakEvenX},${yScale(0)} L ${xScale(spotRangeGlobal[0])},${yScale(0)} Z" fill="var(--fondo-rojo)" />`;
        svg.innerHTML += `<polyline points="${points}" fill="none" stroke="var(--azul-principal)" stroke-width="3"/>`;
        svg.innerHTML += `<circle id="indicator-${svgId}" r="5" fill="var(--rojo-perdida)" stroke="#fff" stroke-width="2"/>`;
    }

    function setupInteractiveChart(config) {
        const { id, strategy, initialSpot } = config;
        const { pnlFunction, pnlRange } = strategy;

        const slider = document.getElementById(`spotSlider${id}`), pnlDisplay = document.getElementById(`pnlDisplay${id}`), simSpotDisplay = document.getElementById(`simSpot${id}`), pnlValueDisplay = document.getElementById(`pnlValue${id}`), indicator = document.getElementById(`indicator-pnlChart${id}`);
        const width = 500, height = 300, margin = { top: 20, right: 20, bottom: 50, left: 50 };
        const chartWidth = width - margin.left - margin.right, chartHeight = height - margin.top - margin.bottom;
        const xScale = (spot) => margin.left + ((spot - spotRangeGlobal[0]) / (spotRangeGlobal[1] - spotRangeGlobal[0])) * chartWidth;
        const yScale = (pnl) => margin.top + chartHeight - ((pnl - pnlRange[0]) / (pnlRange[1] - pnlRange[0])) * chartHeight;

        function updateDisplay(spot) {
            const pnl = pnlFunction(spot) * contractSize;
            simSpotDisplay.textContent = `Spot: ${formatSpot(spot)}`;
            pnlValueDisplay.textContent = formatCLP(pnl);
pnlDisplay.classList.toggle('pnl-profit', pnl >= 0);
pnlDisplay.classList.toggle('pnl-loss', pnl < 0);
            if (indicator) { indicator.setAttribute('cx', xScale(spot)); indicator.setAttribute('cy', yScale(pnlFunction(spot))); }
        }
        slider.addEventListener('input', (e) => updateDisplay(parseFloat(e.target.value)));
        updateDisplay(initialSpot);
    }

    // --- INICIALIZACIÓN DE TODO ---
    updateSkewChart('1M');

    const bpsStrategy = { ...bps, pnlFunction: calculateBpsPnl, pnlRange: [bps.maxLoss - 2, bps.maxProfit + 2] };
    const bcsStrategy = { ...bcs, pnlFunction: calculateBcsPnl, pnlRange: [bcs.maxLoss - 2, bcs.maxProfit + 2] };
    
    drawPnlChart({ svgId: 'pnlChartBPS', strategy: bpsStrategy });
    setupInteractiveChart({ id: 'BPS', strategy: bpsStrategy, initialSpot: 959.26 });
    
    drawPnlChart({ svgId: 'pnlChartBCS', strategy: bcsStrategy });
    setupInteractiveChart({ id: 'BCS', strategy: bcsStrategy, initialSpot: 959.26 });
});
</script>

</body>
</html>
